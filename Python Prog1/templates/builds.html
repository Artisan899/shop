<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Готовые сборки</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-img-top {
            height: 200px;
            object-fit: contain;
        }
        .card-body {
            display: flex;
            flex-direction: column;
        }
        .price {
            font-size: 1.25rem;
            font-weight: bold;
            color: #d9534f;
        }
        .btn-add-to-cart {
            background-color: #28a745;
            color: white;
            font-weight: bold;
        }
        .btn-add-to-cart:hover {
            background-color: #218838;
        }
        .cart-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }
        .cart-status {
            font-weight: bold;
            color: #28a745;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .quantity-controls button {
            width: 30px;
            height: 30px;
            font-weight: bold;
            font-size: 18px;
            padding: 0;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-3">
    <!-- Кнопка Корзина справа сверху -->
    <div class="d-flex justify-content-end">
        <a href="/cart" class="btn btn-outline-primary d-inline-flex flex-column align-items-center" id="cart-button">
            <img id="cart-icon" src="{{ url_for('static', filename='pin/basket.jpg') }}" alt="Корзина" style="width: 40px; height: 40px;">
            <span>Корзина</span>
        </a>
    </div>
</div>

<div class="container mt-4">
    <h2 class="text-center mb-4">Готовые сборки</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for build in builds %}
        <div class="col">
            <div class="card h-100">
                <img src="{{ url_for('static', filename='images/builds/' + build.image) }}" class="card-img-top" alt="{{ build.name }}">
                <div class="card-body">
                    <h5 class="card-title">{{ build.name }}</h5>
                    <ul class="list-unstyled">
                        <li><strong>Процессор:</strong> {{ build.cpu }}</li>
                        <li><strong>Видеокарта:</strong> {{ build.gpu }}</li>
                        <li><strong>Материнская плата:</strong> {{ build.motherboard }}</li>
                        <li><strong>Оперативная память:</strong> {{ build.ram }}</li>
                    </ul>
                    <p class="price">Цена: {{ build.price }} ₽</p>
                    <button class="btn btn-add-to-cart" onclick="addToCart(this)">В корзину</button>

                    <!-- Панель управления корзиной (скрыта по умолчанию) -->
                    <div class="cart-controls d-none">
                        <span class="cart-status">Уже в вашей корзине</span>
                        <div class="quantity-controls">
                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(this, -1)">−</button>
                            <span class="quantity">1</span>
                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(this, 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    let cartCount = 0;

    function updateCartIcon() {
        const cartIcon = document.getElementById('cart-icon');
        let imageName = 'basket.jpg'; // default (empty)

        if (cartCount >= 1 && cartCount <= 5) {
            imageName = `basket${cartCount}.jpg`;
        } else if (cartCount > 5) {
            imageName = 'basket55.jpg';
        }

        cartIcon.src = `/static/pin/${imageName}`;
    }

    function addToCart(button) {
        const cardBody = button.closest('.card-body');
        const controls = cardBody.querySelector('.cart-controls');
        button.classList.add('d-none');
        controls.classList.remove('d-none');

        cartCount++;
        updateCartIcon();
    }

    function changeQuantity(btn, delta) {
    const controls = btn.closest('.cart-controls');
    const quantityDisplay = controls.querySelector('.quantity');
    let quantity = parseInt(quantityDisplay.textContent);

    if (quantity === 1 && delta === -1) {
        // Скрыть панель управления и вернуть кнопку "В корзину"
        controls.classList.add('d-none');
        const cardBody = btn.closest('.card-body');
        const addButton = cardBody.querySelector('.btn-add-to-cart');
        addButton.classList.remove('d-none');

        cartCount--;
        if (cartCount < 0) cartCount = 0;
        updateCartIcon();
        return;
    }

    quantity += delta;
    quantityDisplay.textContent = quantity;

    // Обновление глобального счётчика корзины
    cartCount += delta;
    if (cartCount < 0) cartCount = 0;
    updateCartIcon();
}

</script>

</body>
</html>
